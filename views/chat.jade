#chat_room.row

  #chat_conversations.col_12.col(style="height: 100%;")
    .ui-widget-content.ui-corner-all(style="padding: 5px; height: 94%; overflow-y: scroll;")
      ul

  #chat_users.col_4.col.ui-widget(style="height: 100%;")
    .ui-widget-header.ui-corner-top(style="border-bottom: 0; padding: 5px;") Usuários
    .ui-widget-content.ui-corner-bottom(style="padding: 5px; height: 88%;")
      ul

.row

  #chat_text.col_13.col
    input(type='text', placeholder='Digite aqui sua mensagem')#text

  #chat_controls.col_3.col
    button(type='button')#send Enviar
    button(type='button')#clear Limpar

  script(type="text/javascript")
    $(function() {
      // Set focus on text input
      $("#text").focus();
  
      // Prompt for user email
      var email = '';
      while(email === null || email === '') {
        email = prompt('Qual seu email?', '');
      }

      // Socket.io
      var socket = new io.Socket('localhost');
      socket.connect();

      socket.on('connect', function() {
        socket.send({action: 'join', email: email});
      });

      socket.on('message', function(data) {
        if (data.action === 'message') {
          $("<li></li>").text(data.email + ": " + data.message).appendTo("#chat_conversations ul");

        } else if (data.action === 'join') {

          if(data.email === email) {
            // Set my email on page
            $("#login_menu").html(data.email);
          }

          // Add email to users list
          $("<li data-name='" + data.email + "'></li>").text(data.email).appendTo("#chat_users ul");
  
          // If this is a new user who joinned, add a message about it
          if (data.newUser) {
            $("<li></li>").text('Usuário ' + data.email + " entrou no chat").appendTo("#chat_conversations ul");
          }

        } else if (data.action === 'leave') {
          $("li[data-name='" + data.email + "']").remove();
          $("<li></li>").text('Usuário ' + data.email + " saiu do chat").appendTo("#chat_conversations ul");
        }
      });

      socket.on('disconnect', function() {
        alert('Você foi desconectado do servidor...');
      });
      
      function send() {
        socket.send({action: 'message', message: $('#text').val()});
        $('#text').val('');
        $('#text').focus();
      };

      $("#send").click(send);
      $("#text").keyup(function(e) {
        if (e.keyCode === 13) {
          send();
        }
      });

      $("#clear").click(function() {
        $("#text").val('');
        $('#text').focus();
      });
    });
